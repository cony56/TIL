# Cloud Guru 실습을 통한 AWS서비스 학습



AWS 클라우드 서비스 범위

1) 컴퓨팅 - 물리 서버가 하는 역할을 복제한 클라우드 서비스

ex) Auto Scaling, Load Balancing, Serverless

-> EC2(Elastic Compute Cloud)

* lambda
* Auto Scaling
* Elastic Load Balancing
* Elastic Beanstalk

2) 네트워킹 - 어플리케이션 연결, 접근 제어, 원접 연결

- VPC(Virtual Private Cloud)
- Direct Connect
- Route 53
- CloudFront

3) 스토리지 - 빠른 액세스 , 장기 백업과 같은 요구를 충족하는 스토리지 플랫폼

- S3(Simple Storage Service)- 파일 데이터를 쌓아두는 곳
- Glacier- 장기보관
- EBS(Elastic Block Storage) - 
- Storage Gateway

3) 데이터베이스 - 관계형, NoSQL, 캐싱 등

- RDS(Relational Database Service)
- DynamoDB

어플리케이션 관리

* CloudWatch
* CloudFormation
* CloudTrail

보안과 자격 증명

* IAM(Identity and Access Management) - 사용자 계정 관리
* KMS(Key Management Service) - 암호화 키 만들고 관리해줌
* Directory Service

어플리케이션 통합

* SNS(Simple Notification Service) - 앱과 연동하여 푸쉬 알림, 문자 보낼 수 있음
* Simple WorkFlow(SWF)
* SQS(Simple Queue Service) - 비동기서비스(일이 끝나는거 기다리지 않음)

-> 일이 다 되었는지 안됐는지 저장해놓음

* API Gateway

Introduction to AWS Identity and Access Management(IAM)



#### IAM

- 자격을 인증하고 권한을 부여
- AWS 고객이 AWS 계정 및 AWS 내에서 사용 가능한 API 및 서비스에 대한 사용자의 액세스 및

권한을 관리할 수 있도록 하는 서비스

* 사용자, 보안 자격 증명(Ex. API Access Key)을 관리하고 사용자가 AWS 리소스에 액세스할 수 있도록 허용할 수 있음

#### IAM 정책

- 리소스에 연결된 작업을 정의하는 정책 문서
- 사용자가 작업에 대해 갖는 효과(리소스에 대한 작업의 허용 여부)를 명시함
- Cloud 관리자는 allow_all이란 관리형 정책을 통해 대부분 리소스에 접근해 다양한 action을 할 수 있음

1) 사용자 그룹 내에 포함시키기

2) 정책문서 반영하기

인라인 정책, 관리형 정책으로 나뉨

{

​		"Version":"2012-10-17"

​		"Statement": {			<= 정책 문서

​					{

​					"Resource":"*",	<= 자원

​					"Action": "*",	<= 작업

​					"Effect":"Allow"	<= 효과 = 리소스에 대한 작업의 허용 여부를 명시					

​					}

​		}

}

--> Group 내 정책 문서에서 Action은 어떤 작업(StopInstance, StartInstance, Describe 등)을 할 수 있는지, Resource는 EC2, S3와 같은 서비스를 명시하고,

Effect는 "Allow"를 통해 작업을 허용해주는 것을 의미함

일괄되게 관리하고 적용하는 걸 관리형 정책, 개별적으로 사용자 or 그룹을 관리하는 걸 인라인 정책

관리형 정책은 기본적으로 적용되는 정책이 있고 사용자가 직접 정의하는 방법이 있음.



### Creating a Basic Amazon S3 Lifecycle Policy

#### Amazon S3

- 객체 기반의 무제한 파일 저장 스토리지
- 99.999999999 내구성
- 사용한 만큼만 지불 (GB 당 과금)
- 객체 URL을 통해 쉽게 파일을 공유
- 정적 웹 사이트 호스팅 가능(매우 강력)

 ** 동적, 정적의 개념

동적 - 요청 파라미터, 사용자의 입력에 따라 다른 내용이 나오는 것 -> ex) 네이버 검색: '국군의 날'

정적 - 항상 고정된 내용의 데이터에 access하는 것 -> ex) 네이버 로고의 png 파일



#### Amazon Glacier

* 99.9999999 내구성
* 아카이브 및 백업 유도
* S3 대비 1/5 비용

버켓 - 하나의 저장소라고 보면됨

#### S3의 기능

1) 버전 관리 - 설정되어 있으면 동일 파일에 대한 이전 파일을 보존할 수 있고 이전 버전을

객체 url을 통해 접근할 수 있음

2) 또한 권한 탭에서 퍼블릭 액세스 차단을 해제하고 액세스 제어 목록에 대해 모든 사람이 볼 수 있게 하여 https로 호출할 수 있음

3) 수명 주기 규칙- 지정한 형태의 파일들을 더 값싸고 불러오는데 오래걸리는 Glacier에 넣어줄 수 있음

이는 스토리지 클래스 간에 객체를 이전하는 것임



### Configuring Amazon S3 Buckets to Host a Static Website with a Custom Domain



DNS 레코드에 버킷 웹사이트 앤드포인트를 등록

DNS 레코드

- DNS 서버 명령
- 도메인에 연계된 IP주소와 해당 도메인에 대한 요청의 처리 방법에 대한 정보를 제공
- A 레코드: 도메인의 IP주소를 갖고 있는 



### Creating a Basic VPC and Associated Components



#### 리전

* AWS 서비스가 운영되는 지역
* 복수개의 데이터 센터들의 집합

#### 가용영역(AZ)

* 리전 내에 위치한 데이터 센터 -> 서브넷이 상주할 영역
* 물리적으로 분리되어 있음 -> 고가용성을 보장하기 위해

#### VPC(Virtual Private Cloud)

* AWS 계정 전용 가상 네트워크
* 한 AWS 리전 안에서만 존재할 수 있고 한 리전에 만든 VPC는 다른 리전에서는 보이지 않음
* 연속적인 IP 주소 범위로 구성 => CIDR 블록으로 표시
  * 10.0.0/8 10.0.0 ~ 10.255.255.255
  * 172.16.0.0/12 -> 172.16.0.0 ~ 172.31.255.255
  * 192.168.0.0/16 -> 192.168.0.0 ~ 192.168.255.255

#### 서브넷(subnet)

* VPC 내 논리 컨테이너
* EC2 인스턴스를 배치하는 장소 => 인스턴스는 서브넷 안에 위치
  * 서브넷에 인스턴스를 생성하면 다른 서브넷으로 이동할 수 없음
  * 인스턴스를 종료하고 다른 서브넷에 새 인스턴스를 생성
* 인스턴스를 서로 격리하고, 인스턴스 간의 트래픽 흐름을 제어하고, 인스턴스를 기능별로 묶을 수 있음

ex) 웹서버와 DB서버(외부에서 접근 못하는)을 격리할 수 있음

* 서브넷 CIDR 블록

  * VPC의 일부, VPC 내에서는 유니크해야 함

  * 모든 서브넷에서 처음 4개의 IP와 마지막 1개는 예약되어 있으므로 인스턴스에 할당할 수 없음

    * ex) 서브넷 CIDR 172.16.100.0/24 인 경우

      172.16.100.0~172.16.100.3

      172.16.100.255 는 사용할 수 없음

* 서브넷은 하나의 가용 영역(AZ) 내에서만 존재할 수 있음

#### ENI(Elastic Network Interface, 탄력적 네트워크 인터페이스)

* 물리 서버의 NIC(Network Interface Controller)와 같은 기능을 수행함
* 모든 인스턴스에는 기본 ENI가 존재하며, 이 인터페이스는 하나의 서브넷에만 연결됨

#### IGW(Internet Gateway, 인터넷 게이트웨이)

* 퍼블릭 IP 주소를 할당받은 인스턴스가 인터넷과 연결되어서 인터넷으로부터 요청을 수신할 수 있도록 해주는 기능
* 처음 VPC를 생성하더라도 IGW가 연결되지는 않음 => 직접 IGW를 생성하고 VPC와 연결해야 함
* VPC는 하나의 IGW만 연결 가능

IPv4 주소   -> 172.30.1.16

​						------------   ----										

​                      (네트워크 id) (호스트 아이디)

호스트 아이디 -> 같은 네트워크(서브넷) 안에 묶인 여러가지

게이트웨이 

ex) 172.30.1.254 

-> 나가는 통로, 서로 다른 네트워크 간에 통신을 하기 위해 접근하는 첫 지점,

한 네트워크 내에 인스턴스들이 외부 네트워크로 나가기 위한 통로

#### 라우팅 테이블

- VPC는 소프트웨어 함수로 IP 라우팅을 구현한 라우터를 제공 => 사용자는 라우팅 테이블만 관리
- 라우팅 테이블은 하나 이상의 라우팅과 하나 이상의 서브넷 연결로 구성
- VPC를 생성하면 기본 라우팅 테이블을 자동으로 만들고 해당 VPC의 모든 서브넷과 연결
- 만약 추가적인 라우팅 테이블을 안만들면 모든 서브넷들이 연결된 기본 라우팅 테이블 구조로 VPC네트워크가 구성됨

#### 라우팅

* 라우팅 테이블과 연결된 서브넷 내 인스턴스에서 트래픽을 전달하는 방법을 결정

* 어떤 호스트를 다른 호스트와 연결해주는 과정

* 라우팅 테이블에는 같은 VPC에 있는 인스턴스 간에 통신할 수 있게 하는 로컬 라우팅이 필수적으로 포함되어야 함

* 기본 라우팅

  -- 인스턴스가 인터넷에 액세스하게 하려면 igw를 가리키는 기본 라우팅을 생성해야 함

  ​		대상주소(target adress): 0.0.0.0/0 <- 인터넷 상의 모든 호스트의 IP주소

  ​		대상 		:igw-xxxx...

* 퍼블릭 서브넷 : IGW를 가리키는 기본 라우팅이 포함된 라우팅 테이블과 연결된 서브넷

* 프라이빗 서브넷: 기본 라우팅이 포함되어 있지 않음 -> 즉 인터넷과 연결되지 않음

* 라우팅을 결정할 때는 가장 근접하게 일치하는 항목을 기반으로 라우팅

  대상 주소							대상

  172.31..0.0/16					LOCAL

  0.0.0.0/0							igw-xxxx...

  198.51.100.50으로 패킷을 보내려 하면, IGW로 보내게 됨

  172.31.0.10으로 패킷을 보내려고 하면, 172.31.0.10으로 패킷을 전달함

#### 보안 그룹(security group)

 - 방화벽과 같은 기능을 제공
   	- 상태 저장 방화벽 역할
   	- 보안 그룹이 트래픽을 한 방향으로 전달되도록 허용할 때, 반대 방향의 응답 트래픽을 지능적으로 허용
   	- 인스턴스의 ENI에서 송수신되는 트래픽을 허가해서 인스턴스를 오가는 트래픽을 제어
    - 모든 ENI는 최소 하나 이상의 보안 그룹과 연결되어야 함
      	- 보안 그룹과 ENI는 N:N 관계를 유지함
      	- 보안 그룹 생성 시, 보안 그룹 이름, 설명, 포함될 VPC를 지정, 보안 그룹 생성 후에 인바운드, 아웃바운드 규칙을 지정해서 트래픽을 제어

#### NACL(Network Access Control List)

* 서브넷을 통과하는 걸 허용해주는 게 NACL의 역할임

 - 보안 그룹과 유사

   	- 원본(source)/대상(target) 주소 CIDR, 프로토콜, 포트를 기반으로 트래픽을 허용하는 인바운드, 아웃바운드 규칙을 포함함
   	- VPC에는 삭제할 수 없는 기본 NACL이 존재함

 - NACL은 ENI가 아닌 서브넷에 연결 됨, 해당 서브넷과 송수신하는 트래픽을 제어

   	- 서브넷 내의 인스턴스 간 트래픽을 제어할 떄는 NACL을 사용할 수 없음

 - NACL은 상태를 저장하지 않음 = NACL은 통과하는 연결 상태를 추적하지 않음

   - 모든 인바운드, 아웃바운드 트래픽의 허용 규칙을 별도로 작성해야 함

     -> 안으로 들어오는 것과 밖으로 나가는 것에 대해 어떤 포트를 허락할지

- Nacl 규칙은 규칙 번호의 오름차순으로 처리

#### NatGateway

* 프라이빗 서브넷을 외부와 연결하기 위해 필요한 게이트웨이로 주로 업데이트를 할 때 서버에서 클라이언트에게 내보냄
* NatGateway를 생성하려면 NAT 게이트웨이가 속할 퍼블릭 서브넷을 지정해야 함
* 또한 NAT 게이트웨이와 연결할 탄력적 IP주소도 지정해야 함

** 탄력적 IP주소

- 동적 클라우드 컴퓨팅을 위해 고안된 고정 퍼블릭 IPv4 주소로 계정의 모든 VPC에 있는 모든 인스턴스에 탄력적 IP 주소를 연결할 수 있음. 때문에 NAT게이트웨이와 연결하면 외부와 통신할 수 있는거임.

- 탄력적 IP 주소는 한 번에 단일 인스턴스 or 네트워크 인터페이스와 연결 가능
- 인스턴스 or 네테ㅡ워크 인터페이스 간에 탄력적 IP 주소를 이동할 수 있음



Building a Three-Tier Network VPC from Scratch in AWS

실습하기