## HTTPS와 SSL 인증서



**해당 글은 생활코딩 블로그의 글을 리뷰하며 공부하는 차원에서 적은 문서임을 미리 밝힘 **



### 글 요약

SSL 통신은 서버와 클라이언트 간 통신의 보안성을 높이고자 전송 내용(문서)를 암호화하는 기술이다. 이 때 컴퓨팅 파워를 최소화하는 동시에 정보의 노출을 막기 위해 공개키와 대칭키가 혼합된 방식으로 키를 생성하는게 기술의 핵심이다. 클라이언트는 서버와 통신이 가능한지 먼저 확인해보고 키를 생성한 후 데이터를 암호화하여 주고 받는다.



### HTTPS



* HTTP는 Hypertext Transfer Protocol의 약자로 HTML을 전송하기 위한 통신규약을 의미함
* HTTPS의 S는 Over Secure Sockets Layer의 약자로 보안이 강화된 HTTP라고 이해해도 됨
* HTTPS는 HTML 전송간에 암호화 방식을 적용한 통신규약



### SSL(Secure Sockets Layer)

* HTTPS 프로토콜은 SSL 프로토콜 위에서 돌아감
* SSL은 브라우저와 웹사이트(클라이언트와 서버) 사이에 전송된 데이터를 암호화하여 인터넷 통신 간 보안을 유지하는 암호 규약임
* SSL 인증서 : 클라이언트와 서버간의 통신을 제 3자가 보증해주는 전자화된 문서
  * 통신 내용이 노출되는 것을 막을 수 있음
  * 클라이언트가 접속하려는 서버가 신뢰할 수 있는 서버인지를 판단할 수 있음
  * 통신 내용의 악의적인 변경을 방지할 수 있음




### SSL의 암호화 과정

* SSL은 두가지 암호화 기법을 혼용해서 사용함으로 이 기법들을 왜 쓰고 어떻게, 왜 혼합하는지 알아야 함
* 암호를 만드는 행위를 **암호화**, 암호를 푸는 행위를 **복호화**라고 하며 **키**를 통해 암호화, 복호화가 가능함

#### 대칭키

* 암호화와 복호화를 할 때 동일한 키를 사용하는 기법
* 상대방이 암호를 복호화하려면 대칭키를 통신으로 전달해야 하는데, 대칭키가 유출되면 키를 획득한 공격자가 암호 내용을 복호화 할 수 있으므로

​	암호화가 쓸모 없어짐

#### 공개키

* 한 쌍의 키를 통해 암호와와 복호화를 진행하는 기법

  -> A키로 암호화를 하면 B키로 복호화가 가능하고, B키로 암호화하면 A키로 복호화가 가능함

* 이 때 본인이 갖고 있는 키는 비공개키(private key) 혹은 개인키라 하고 나머지를 공개키(public key)로 지정하여 타인에게 제공함

* 공개키를 사용하는데는 2가지 방식이 있음

  * 공개키 제공 -> 상대방이 공개키로 암호화한 후 정보 전송 -> 비공개키로 복호화

  * 비공개키로 암호화한 정보와 공개키를 함께 전송 -> 상대방이 공개키로 복호화

    **하지만 공개키를 공격자가 받으면 복호화할 수 있으므로 대칭키의 단점이 보완되지 않는데 왜 쓸까?**

    -> 암호화가 아닌 상대방의 신뢰를 보장해주기 위한 용도(비공개키를 갖고 있다는 증거)로 쓰이기 때문

#### SSL 인증서

* SSL 인증서는 클라이언트가 접속한 서버의 신뢰성과 함께 SSL 통신에 필요한 공개키를 제공함 -> 이렇게 공개키를 2가지 다른 용로 쓰게 됨

* SSL 인증서는 CA(Certificate Authority)를 통해서 구입이 가능함
* SSL 인증서는 서비스의 정보(인증서를 발급한 CA, 서비스의 도메인 등)과 서버 측의 공개키 정보(공개키와 함께 공개키의 암호화 방법에 대한 정보)를 갖고 있음

​	-> 이런 정보와 공개키는 서비스가 CA로부터 인증서를 구입할 때 제출함

​	-> SSL 인증서는 CA의 비공개키를 통해 암호화 됨

* 브라우저(클라이언트)는 미리 SSL 인증서를 발급하는 CA의 리스트와 그들의 공개키를 갖고 있음

  -> 공개키를 통해 SSL 인증서를 복호화함으로써 해당 서버의 신뢰성을 인증함



#### 서버-클라이언트 간 통신의 절차

1. 악수(Handshake)

   - 서버와 클라이언트가 SSL 인증서를 주고 받는 과정

   1> "Client Hello"

   클라이언트가 서버에 접속하는 과정. 클라이언트 측에서 **랜덤 데이터**를 생성하고 **가능한 암호화 방식**을 서버에 전달한다.

   2> "Server Hello"

   서버가 "Client Hello"에 응답하는 과정으로 **랜덤 데이터**를 생성하고 서버 쪽에서도 **사용가능한 암호화 방식**, **SSL 인증서**를 클라이언트에게 전달한다.

   3> 인증서 확인과정

   클라이언트가 CA 리스트를 조회한 후 공개키를 통해 SSL 인증서가 CA에 의해 발급된 것인지 확인함

   4> 세션 키 생성과정

   **서버의 랜덤 데이터**와 **클라이언트의 랜덤 데이터**를 조합하여 pre master secret key(대칭키 방식)를 생성함

   **pre master secret key**를 SSL 인증서를 복호화했을 때 얻는 공개키를 통해 암호화하여 **세션키(session key)**를 생성함

   ** SSL 인증서에 대한 공개키와는 다른, 인증서를 복호화했을 때 내장되어 있는 공개키임

2. 세션

   * 실제로 서버와 클라이언트가 데이터를 주고 받는 단계로 정보를 상대방에게 전송하기 전에 **세션 키**를 이용해서 정보를 대칭키 방식으로 암호화함

     -> 공개키 방식을 그대로 사용하면 컴퓨터 파워가 더 많이 필요하기 때문에 대칭키 방법을 사용함

3. 세션 종료
   * 데이터의 전송이 끝나면 SSL 통신이 끝나났음을 서로에게 알려줌
   * 이 떄 통신에서 사용한 세션키를 폐기함

출처: https://www.opentutorials.org/course/228/4894#session